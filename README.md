# Gorm Expect

A Go database testing library for use with `gorm` that doesn't involve a lot
of pain.

[![GoDoc](https://godoc.org/github.com/iantanwx/gorm-expect?status.svg)](https://godoc.org/github.com/iantanwx/gorm-expect)

## Why

Testing `gorm`-based DALs is terrible. Most of the time, you have to use
`db.Debug()` to print the SQL generated by gorm, escape it, generate mock
`sql.Rows`, etc., and hope for the best. `gormexpect` wraps and mirrors
(mostly) the gorm API for superior DX.

## Installation

```
go get -u github.com/iantanwx/gorm-expect
```

## Usage

```
type User struct {
  gorm.Model
  Name string
  Emails []Email
  Languages []Language `gorm:"many2many:user_languages"`
}

type UserRepository struct {
  db *gorm.DB
}

func (r *UserRepository) Find(limit int, offset int) ([]User, error) {
  var users []User
  err := r.DB.Limit(limit).Offset(offset).Find(&users).Error

  return users, err
}

func TestUserRepoFind(t *testing.T) {
  db, expect, err := expecter.NewDefaultExpecter()
  defer db.Close()

  if err != nil {
    t.Fatal(err)
  }

  repo := &UserRepository{db}

  in := []User{}
  out := User{Name: "my_name"}

  expect.Find(&in).Returns(out)
  user, err := repo.Find(1, 0)

  if err != nil {
  }
}
